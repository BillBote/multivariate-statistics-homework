rawdata1<-read.table("ch7-1.txt")
names(rawdata1)<-c("A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P")
rawdata2<-read.table("ch7-2.txt")
##########################################标准化################################################
for(i in 1:3){
  for(j in 1:3){
    rawdata1[3*(i-1)+j,]<-rawdata1[3*(i-1)+j,]/rawdata2[i,j]*rawdata2[4,j]/rawdata2[4,4]
  }
}
rawdata1<-rawdata1[-10,]
mat<-as.matrix(rawdata1)
#得到标准化后的矩阵：
#A           B           C           D           E           F           G           H           I
#1 0.007601478 0.011402218 0.001900370 0.015202957 0.007601478 0.001900370 0.005701109 0.005701109 0.001900370
#2 0.017424081 0.014934926 0.017424081 0.041071048 0.048538511 0.001244577 0.041071048 0.021157812 0.018668658
#3 0.033655605 0.022437070 0.004807944 0.008013239 0.032052957 0.008013239 0.024039718 0.012821183 0.001602648
#4 0.000000000 0.000000000 0.000000000 0.012172638 0.000000000 0.000000000 0.006086319 0.006086319 0.000000000
#5 0.015959872 0.023939808 0.005319957 0.042559660 0.055859553 0.018619851 0.053199574 0.021279830 0.018619851
#6 0.041032176 0.011723479 0.000000000 0.009769566 0.013677392 0.003907826 0.027354784 0.009769566 0.007815653
#7 0.005004307 0.003336204 0.000000000 0.011676715 0.001668102 0.000000000 0.001668102 0.005004307 0.001668102
#8 0.027131783 0.009043928 0.009043928 0.036175711 0.027131783 0.000000000 0.018087855 0.018087855 0.027131783
#9 0.019450317 0.012966878 0.000000000 0.006483439 0.000000000 0.000000000 0.000000000 0.000000000 0.012966878
#J           K           L          M           N           O           P
#1 0.000000000 0.000000000 0.001900370 0.04560887 0.003800739 0.003800739 0.000000000
#2 0.007467463 0.003733732 0.006222886 0.04853851 0.054761397 0.059739706 0.001244577
#3 0.000000000 0.008013239 0.000000000 0.07372180 0.051284731 0.057695323 0.000000000
#4 0.006086319 0.000000000 0.000000000 0.00000000 0.000000000 0.000000000 0.000000000
#5 0.002659979 0.002659979 0.002659979 0.06117951 0.050539596 0.063839489 0.005319957
#6 0.001953913 0.001953913 0.000000000 0.04689392 0.050801742 0.041032176 0.000000000
#7 0.001668102 0.000000000 0.000000000 0.01501292 0.000000000 0.003336204 0.011676715

##############################一.以年龄组为变量计算相关阵做主成分分析####################################
corr1<-cor(t(mat))
#相关阵如下：
#1         2          3          4         5          6         7         8          9
#1 1.0000000 0.4442168  0.6498159  0.0615354 0.5337374  0.4960381 0.7083490 0.8324510  0.4052240
#2 0.4442168 1.0000000  0.7897506  0.1403303 0.9439811  0.7551492 0.2068797 0.7132919  0.4528943
#3 0.6498159 0.7897506  1.0000000 -0.2551618 0.8115336  0.9191191 0.2992722 0.7072433  0.6351121
#4 0.0615354 0.1403303 -0.2551618  1.0000000 0.1134358 -0.1515817 0.2870806 0.1337974 -0.2403313
#5 0.5337374 0.9439811  0.8115336  0.1134358 1.0000000  0.7378559 0.2804638 0.7104585  0.3887952
#6 0.4960381 0.7551492  0.9191191 -0.1515817 0.7378559  1.0000000 0.2289081 0.6795005  0.7721483
#7 0.7083490 0.2068797  0.2992722  0.2870806 0.2804638  0.2289081 1.0000000 0.5866803  0.1779722
#8 0.8324510 0.7132919  0.7072433  0.1337974 0.7104585  0.6795005 0.5866803 1.0000000  0.5948887
#9 0.4052240 0.4528943  0.6351121 -0.2403313 0.3887952  0.7721483 0.1779722 0.5948887  1.0000000
eigen1<-eigen(corr1)
#计算特征值如下：
#5.241180456 1.583084131 1.048256183 0.562348868 0.263205323 0.174214599 0.077494762 0.041200377 0.009015301
(eigen1$values[1]+eigen1$values[2]+eigen1$values[3])/sum(eigen1$values)
#前三个主成分贡献率为0.87，使用前三个做主成分分析
eigen1$vectors[,1:3]
#主轴如下：
#[,1]        [,2]        [,3]
#[1,] -0.3358199096 -0.30120244  0.37133649
#[2,] -0.3723786365  0.04909614 -0.46349135
#[3,] -0.4033119128  0.21396166  0.01658608
#[4,]  0.0009439713 -0.61278944 -0.48902124
#[5,] -0.3776945544  0.00422820 -0.40413025
#[6,] -0.3883561008  0.25700323 -0.04071832
#[7,] -0.2156741960 -0.54383898  0.39695606
#[8,] -0.3934310980 -0.19462808  0.10497360
#[9,] -0.3018620946  0.29303021  0.27257164
#计算主成分
mainfactor1<-matrix(ncol = 3,nrow=16)
for(i in 1:3){
  mainfactor1[,i]<-t(mat)%*%eigen1$vectors[,i]
}
mainfactor1
#主成分如下：
#            [,1]          [,2]         [,3]
#[1,] -0.062202943  0.0140771503 -0.002679402
#[2,] -0.040226401  0.0054388651 -0.006660064
#[3,] -0.014633120 -0.0004259336 -0.008491071
#[4,] -0.062196523 -0.0171079335 -0.026608040
#[5,] -0.070998573  0.0045151072 -0.038764012
#[6,] -0.012883715  0.0022862864 -0.007422231
#[7,] -0.065090964  0.0045408108 -0.039549147
#[8,] -0.034985424 -0.0053059675 -0.015565505
#[9,] -0.033252694  0.0003863460 -0.008718901
#[10,] -0.004898219 -0.0037567784 -0.006929818
#[11,] -0.006385670  0.0024112467 -0.002752182
#[12,] -0.003960111 -0.0002556293 -0.003253555
#[13,] -0.138459008  0.0019432599 -0.013065428
#[14,] -0.101629787  0.0300052616 -0.033928479
#[15,] -0.096631251  0.0215131930 -0.047800498
#16,] -0.004991139 -0.0062666552  0.001908336
######################分析#######################
#由第一个主轴发现，除第四个为0.0009之外，其他均在-0.401～-0.2之间，说明各年龄组有造成体检异常的公共因素，
#也就是环境、生活条件等因素，因此我们把第一主成分称为环境因素；
#对于第二主轴，1、4、7（对应青年组）均为负，2、5、8（对应老年组）均为正，可见体检异常和年龄有关，因此称
#第二主成分为年龄因素；
#对于第三主轴，4、5、6（对应干部群）均为负，7、8、9（对应工人群）均为正，因此异常和工作性质有关，称第三
#主成分为工作因素。


###########################二.以各病症为变量计算相关阵#################################
corr2<-cor(mat)
eigen2<-eigen(corr2)
#特征值如下：
#[1]  8.582122e+00  2.887913e+00  1.534789e+00  1.285557e+00  5.932406e-01  5.660554e-01  3.851230e-01
#[8]  1.651996e-01  2.023152e-16  2.070043e-17 -3.112679e-17 -4.295341e-17 -1.011287e-16 -2.187627e-16
#[15] -3.252255e-16 -1.110466e-15
(eigen2$values[1]+eigen2$values[2]+eigen2$values[3]+eigen2$values[4])/sum(eigen2$values)
#前四个主成分贡献率为0.89，使用前三个主成分做主成分分析
#主轴如下:
eigen2$vectors[,1:4]
#           [,1]        [,2]        [,3]        [,4]
#[1,] -0.16546072  0.40107511  0.31199234 -0.05627884
#[2,] -0.27493409  0.25607053 -0.14120882  0.05831544
#[3,] -0.25469200 -0.27000033  0.25584357 -0.13977881
#[4,] -0.25036128 -0.33860119  0.09355259  0.28671915
#[5,] -0.33364368 -0.07992137 -0.08341083  0.07193772
#[6,] -0.22391952  0.14604352 -0.44932541  0.24800573
#[7,] -0.32180592 -0.05736650 -0.14825952  0.01021006
#[8,] -0.31023265 -0.15688636  0.04157337  0.10587033
#[9,] -0.20392852 -0.16071567  0.43696192  0.39335162
#[10,] -0.07298827 -0.42931969 -0.13319171 -0.48353634
#[11,] -0.22330495  0.26329161 -0.19905514 -0.38229293
#[12,] -0.21408618 -0.34957162 -0.03812519 -0.23037235
#[13,] -0.27323423  0.23876991  0.13542810  0.16295209
#[14,] -0.29232371  0.18602575  0.08576655 -0.16276391
#[15,] -0.32189928  0.09686119 -0.15469166 -0.15209230
#[16,]  0.04338713 -0.16651987 -0.52590350  0.38699048

#计算主成分
mainfactor2<-matrix(ncol=4,nrow=9)
for(i in 1:4){
  mainfactor2[,i]<-mat%*%eigen2$vectors[,i]
}
#             [,1]         [,2]          [,3]          [,4]
#[1,] -0.030838670  0.009751704  0.0072465168  0.0125554881
#[2,] -0.112928209  0.002785789  0.0093667823  0.0069539628
#[3,] -0.094993773  0.045033995  0.0045692588 -0.0006063913
#[4,] -0.007338575 -0.008038657 -0.0003211914  0.0012536742
#[5,] -0.124725058  0.013491990 -0.0059890492  0.0218900820
#[6,] -0.072775072  0.035567883  0.0126405221 -0.0010431392
#[7,] -0.012445778 -0.001127323 -0.0021128307  0.0102350081
#[8,] -0.075405161  0.010017623  0.0286513086  0.0259813391
#[9,] -0.027928640  0.018144770  0.0149213835  0.0035280358

##############################分析###############################
#从第一主成分可以看出第4（对应于干部群中的青年组）、第7分量（工人群中的青年组）的值最大，
#而第2分量（教师群中的中年组）、第5分量（干部群中的中年组）的值最小；另外从三个职业群中各
#老年组看，第9分量（工人群中的老年组）较大，这些表明干部群和工人群中青年组体质最好，而教师
#群和干部群中的中年组体质最差，而在各职业群的老年组中，以退休老工人体质最好。

#再对第一主轴进行分析，在这16个分量中，其中第10（对应于精神病）、第16分量（先天性心脏病或
#风湿性心脏病）的值接近于0，这两种异常与其它异常不同，属于遗传性影响很大的疾病，而其余14种异常
#可能来自于各种职业群的影响，只是体质弱的容易产生异常，而体质强的不易产生异常。可以看出，教师
#群中的中年组和干部群中的中年组体质状况最差，产生这些异常的人数多。因此称第一主成分为强弱因子。

#关于第二主成分，分量多是正值，第3（教师群中的老年组）、第6分量（干部群中的老年组）相应的分量值
#的绝对值最大。
#再对第二主轴进行分析。这里第1、2、6、10、13、14、15分量全是正值，相应地异常多是心血管病，如高血压、
#临界高血压、心电图异常、血脂增高等，因此我们可把第二主成分称为心血管病理因子，注意到第二主成分中教师群、
#干部群中老年组相应分量地负值绝对值最大，表明这两种人患心血管病地较多。
